#!/usr/bin/env node

const fs = require('fs');

if (!fs.existsSync('.bpmnlintrc')) {
  console.error(`
Cannot not find local .bpmnlintrc file, please create one:

  npx bpmnlint --init

Refer to https://github.com/bpmn-io/bpmnlint#configuration for details.
`);

  process.exit(1);
}

const argv = process.argv.slice(2);

const [ arg ] = argv;

if (arg === '--help') {
  console.log('usage: bpmnlint-playground [diagram]');

  process.exit(0);
}

if (arg) {

  const path = require('path');

  const relativePath = path.relative(process.cwd(), path.resolve(arg));

  if (relativePath.startsWith('../')) {
    console.error(`diagram <${arg}> must be within working directory`);

    process.exit(1);
  }

  if (!fs.existsSync(arg)) {
    console.error(`diagram <${arg}> does not exist`);

    process.exit(1);
  }

}

const { run } = require('./playground');

console.log('Opening playground...');

run(arg).catch(err => {
  console.error('failed to start bpmnlint-playground', err);

  process.exit(1);
});